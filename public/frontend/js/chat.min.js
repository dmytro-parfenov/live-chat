function sendMessage(){var e=$(".send-message-container input").val(),o=$(".send-message-container input").data("token");e.length>0&&$.ajax({type:"POST",url:"/send-message",data:{_token:o,message:e},success:function(){$(".send-message-container input").val("")}})}function soundNotification(e){var o=new Audio;o.src=e,o.autoplay=!0}function sendNotification(e,o){function n(){window.focus(),$("html, body").animate({scrollTop:$(document).height()},500),this.close()}if("granted"===Notification.permission){var a=new Notification(e,o);a.onclick=n}else"denied"!==Notification.permission&&Notification.requestPermission(function(a){if("granted"===a){var t=new Notification(e,o);t.onclick=n}})}function windowScroll(e){$("html, body").animate({scrollTop:e},500,function(){showToolPannel=!1;var e=!0,o=0;$(window).scroll(function(n){var a=$(this).scrollTop();a>o?(showToolPannel&&($(".tool-pannel").stop(),$(".tool-pannel").animate({right:"-50px"},500),showToolPannel=!1),e||($(".send-message-container").stop(),$(".send-message-container").animate({bottom:"0"},500),e=!0)):(showToolPannel||"block"===$(".search-form").css("display")||($(".tool-pannel").stop(),$(".tool-pannel").animate({right:"0"},500),showToolPannel=!0),e&&($(".send-message-container").stop(),$(".send-message-container").animate({bottom:"-70px"},500),e=!1)),o=a})})}$(document).ready(function(){windowScroll($(document).height()),$(".send-message-container input").keyup(function(e){13===e.keyCode&&sendMessage()}),$(".send-message-container button").click(function(){sendMessage()}),$(".search").click(function(){$(".tool-pannel").stop(),$(".tool-pannel").animate({right:"-50px"},500),showToolPannel=!1,$(".search-form").slideDown(500)}),$(document).click(function(e){$(e.target).closest(".search-form").length||$(e.target).closest(".search").length||$(e.target).closest(".search-result-again span").length||($(".search-form").slideUp(500),e.stopPropagation())}),$("body").on("click",".map-marker",function(){var e=parseFloat($(this).attr("data-user-location-lat")),o=parseFloat($(this).attr("data-user-location-lng")),n={lat:e,lng:o};mapObjectLocation=$("#map-object-location")[0];var a=new google.maps.Map(mapObjectLocation,{zoom:14,center:n});$.ajax({type:"GET",url:"https://maps.googleapis.com/maps/api/geocode/json",data:{latlng:e+","+o,language:"en",key:"AIzaSyAIpi0wvFb7yyxMzJZWXYxX3cEQn_byngU"},success:function(e){var o='<div id="content-map-marker">'+e.results[0].formatted_address+"</div>",t=new google.maps.InfoWindow({content:o}),s=new google.maps.Marker({position:n,map:a});google.maps.event.addListener(s,"click",function(){t.open(a,s)})}}),$(".background-map-object, #map-object").stop(),$(".background-map-object, #map-object").fadeIn(500),google.maps.event.trigger(a,"resize");var t=new google.maps.LatLng(e,o);a.setCenter(t)}),$(".background-map-object").click(function(){$(".background-map-object, #map-object").stop(),$(".background-map-object, #map-object").fadeOut(500)}),$(".show-earlier span").click(function(){var e=$(this).attr("data-first-message"),o=$(this).prev().val();$.ajax({type:"POST",url:"/show-more-messages",dataType:"json",data:{_token:o,first_message:e},success:function(e){$(".message-block").first().before(e.html),$(".message-block").hide(),$(".message-block").fadeIn(500),$(".show-earlier span").attr("data-first-message",e.first_message)},error:function(){$(".show-earlier").slideUp(500)}})}),$(".search-result-again span").click(function(){$(".search").click()})}),$(window).on("load",function(){"Notification"in window?Notification.requestPermission():console.log("Your browser does not support HTML5 Notifications");var e=new Pusher("5ccc3f2a7680d594a7dc",{encrypted:!0}),o=e.subscribe("new-message-channel");o.bind("new-message-event",function(e){$("html, body").animate({scrollTop:$(document).height()},500),$(".message-block").last().after(e.html),$(".message-block").last().hide(),$(".message-block").last().fadeIn(500),document.hidden&&(soundNotification("frontend/sounds/get-message.wav"),sendNotification(e.user_name,{body:e.message,icon:"favicon.ico",dir:"auto"}))});var n=e.subscribe("new-user-channel");n.bind("new-user-event",function(e){soundNotification("frontend/sounds/get-message.wav"),sendNotification("New user connected",{body:e,icon:"favicon.ico",dir:"auto"})})});