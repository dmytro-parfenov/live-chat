function sendNotification(e,s){function i(){window.focus(),this.close()}function o(){var e=new Audio;e.src="frontend/sounds/notification.mp3",e.autoplay=!0}if("granted"===Notification.permission){var n=new Notification(e,s);n.onclick=i,o()}else"denied"!==Notification.permission&&Notification.requestPermission(function(n){if("granted"===n){var t=new Notification(e,s);t.onclick=i,o()}})}function subscribe(){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==this.readyState){if(200==this.status&&this.responseText.length>0)for($("html, body").animate({scrollTop:$(document).height()},500),response=jQuery.parseJSON(this.responseText),$(".message-block").last().after(response.html),$(".message-block").last().hide(),$(".message-block").last().fadeIn(500),i=0;i<response.messages.length;i++)null!==response.user_id?response.user_id!==response.messages[i].user_id&&sendNotification(response.messages[i].user_name,{body:response.messages[i].message,icon:"favicon.ico",dir:"auto"}):sendNotification(response.messages[i].user_name,{body:response.messages[i].message,icon:"favicon.ico",dir:"auto"});subscribe()}},e.open("GET","/subscribe-message",!0),e.send()}$(document).ready(function(){}),$(window).on("load",function(){"Notification"in window?Notification.requestPermission():console.log("Your browser does not support HTML5 Notifications"),subscribe()});